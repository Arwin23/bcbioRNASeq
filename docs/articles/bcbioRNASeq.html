<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bcbioRNASeq • bcbioRNASeq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="bcbioRNASeq">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bcbioRNASeq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bcbioRNASeq.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hbc/bcbioRNASeq">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>bcbioRNASeq</h1>
            
            <h4 class="date">13 May 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hbc/bcbioRNASeq/blob/master/vignettes/bcbioRNASeq.Rmd"><code>vignettes/bcbioRNASeq.Rmd</code></a></small>
      <div class="hidden name"><code>bcbioRNASeq.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      RNA-seq analysis involves multiple steps from processing raw sequencing data to identifying, organizing, annotating, and reporting differentially expressed genes. bcbio is an open source, community-maintained framework providing automated and scalable RNA-seq methods for identifying gene abundance counts. We have developed bcbioRNASeq, a Bioconductor package that provides ready-to-render templates and wrapper functions to post-process bcbio output data. bcbioRNASeq automates the generation of high-level RNA-seq reports, including identification of differentially expressed genes, functional enrichment analysis and quality control analysis.
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"bcbioRNASeq"</span>)</a></code></pre></div>
<pre><code>## Loading required package: SummarizedExperiment</code></pre>
<pre><code>## Loading required package: GenomicRanges</code></pre>
<pre><code>## Loading required package: stats4</code></pre>
<pre><code>## Loading required package: BiocGenerics</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## 
## Attaching package: 'BiocGenerics'</code></pre>
<pre><code>## The following objects are masked from 'package:parallel':
## 
##     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,
##     clusterExport, clusterMap, parApply, parCapply, parLapply,
##     parLapplyLB, parRapply, parSapply, parSapplyLB</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     IQR, mad, sd, var, xtabs</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     anyDuplicated, append, as.data.frame, basename, cbind,
##     colnames, dirname, do.call, duplicated, eval, evalq, Filter,
##     Find, get, grep, grepl, intersect, is.unsorted, lapply, Map,
##     mapply, match, mget, order, paste, pmax, pmax.int, pmin,
##     pmin.int, Position, rank, rbind, Reduce, rownames, sapply,
##     setdiff, sort, table, tapply, union, unique, unsplit, which,
##     which.max, which.min</code></pre>
<pre><code>## Loading required package: S4Vectors</code></pre>
<pre><code>## 
## Attaching package: 'S4Vectors'</code></pre>
<pre><code>## The following object is masked from 'package:base':
## 
##     expand.grid</code></pre>
<pre><code>## Loading required package: IRanges</code></pre>
<pre><code>## Loading required package: GenomeInfoDb</code></pre>
<pre><code>## Loading required package: Biobase</code></pre>
<pre><code>## Welcome to Bioconductor
## 
##     Vignettes contain introductory material; view with
##     'browseVignettes()'. To cite Bioconductor, see
##     'citation("Biobase")', and for packages 'citation("pkgname")'.</code></pre>
<pre><code>## Loading required package: DelayedArray</code></pre>
<pre><code>## Loading required package: matrixStats</code></pre>
<pre><code>## 
## Attaching package: 'matrixStats'</code></pre>
<pre><code>## The following objects are masked from 'package:Biobase':
## 
##     anyMissing, rowMedians</code></pre>
<pre><code>## Loading required package: BiocParallel</code></pre>
<pre><code>## 
## Attaching package: 'DelayedArray'</code></pre>
<pre><code>## The following objects are masked from 'package:matrixStats':
## 
##     colMaxs, colMins, colRanges, rowMaxs, rowMins, rowRanges</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     aperm, apply, rowsum</code></pre>
<pre><code>## Loading required package: basejump</code></pre>
<pre><code>## 
## Attaching package: 'bcbioRNASeq'</code></pre>
<pre><code>## The following objects are masked from 'package:basejump':
## 
##     plotDEGHeatmap, plotDEGPCA</code></pre>
<p>For a high-level overview of our <a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> RNA-seq analysis pipeline, including detailed explanation of the <code>bcbioRNASeq</code> S4 class definition, first consult our <a href="http://dx.doi.org/10.12688/f1000research.12093.2">workflow paper</a> published in <em>F1000 Research</em> <span class="citation">(Steinbaugh et al. 2018)</span>. This vignette is focused on more advanced usage and edge cases that a user may encounter when attempting to load a <a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> dataset and perform downstream quality control analysis.</p>
<p><strong>Note:</strong> if you use <a href="http://bioinformatics.sph.harvard.edu/bcbioRNASeq">bcbioRNASeq</a> in published research, please include this citation:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span>(<span class="st">"bcbioRNASeq"</span>)</a></code></pre></div>
<pre><code>## 
## To cite bcbioRNASeq in publications use:
## 
##   Steinbaugh MJ, Pantano L, Kirchner RD, Barrera V, Chapman BA,
##   Piper ME, Mistry M, Khetani RS, Rutherford KD, Hoffman O,
##   Hutchinson JN, Ho Sui SJ. (2018). bcbioRNASeq: R package for
##   bcbio RNA-seq analysis. F1000Research, 6:1976. URL
##   https://f1000research.com/articles/6-1976/v2. DOI
##   10.12688/f1000research.12093.2.
## 
## A BibTeX entry for LaTeX users is
## 
##   @Article{,
##     title = {{bcbioRNASeq}: {R} package for bcbio {RNA-seq} analysis},
##     author = {Michael J. Steinbaugh and Lorena Pantano and Rory D. Kirchner and Victor Barrera and Brad A. Chapman and Mary E. Piper and Meeta Mistry and Radhika S. Khetani and Kayleigh D. Rutherford and Oliver Hofmann and John N. Hutchinson and Shannan J. Ho Sui},
##     journal = {F1000Research},
##     volume = {6},
##     number = {1976},
##     year = {2018},
##     url = {https://f1000research.com/articles/6-1976/v2},
##     doi = {10.12688/f1000research.12093.2},
##   }</code></pre>
</div>
<div id="loading-bcbio-data" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-bcbio-data" class="anchor"></a>Loading bcbio data</h1>
<p>The <code><a href="../reference/bcbioRNASeq.html">bcbioRNASeq()</a></code> constructor function is the main interface connecting <a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> output data to interactive use in <a href="https://www.r-project.org">R</a>. It is highly customizable and supports a number of options for advanced use cases. Consult the documentation available at <code><a href="https://rdrr.io/r/utils/help.html">help(topic = "bcbioRNASeq", package = "bcbioRNASeq")</a></code> for additional details.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/formals.html">formals</a></span>(<span class="st">"bcbioRNASeq"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>()</a></code></pre></div>
<pre><code>## Dotted pair list of 16
##  $ uploadDir         : symbol 
##  $ level             : language c("genes", "transcripts")
##  $ caller            : language c("salmon", "kallisto", "sailfish", "star", "hisat2")
##  $ interestingGroups : chr "sampleName"
##  $ samples           : NULL
##  $ censorSamples     : NULL
##  $ sampleMetadataFile: NULL
##  $ organism          : NULL
##  $ genomeBuild       : NULL
##  $ ensemblRelease    : NULL
##  $ gffFile           : NULL
##  $ transgeneNames    : NULL
##  $ spikeNames        : NULL
##  $ vst               : logi TRUE
##  $ rlog              : logi FALSE
##  $ ...               : symbol</code></pre>
<div id="upload-directory" class="section level2">
<h2 class="hasAnchor">
<a href="#upload-directory" class="anchor"></a>Upload directory</h2>
<p>We have designed the constructor to work as simply as possible by default. The only required argument is <code>uploadDir</code>, the path to the <a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> final upload directory specified with <code>upload:</code> in the YAML configuration. Refer to the <a href="https://bcbio-nextgen.readthedocs.io/en/latest/contents/configuration.html">bcbio configuration</a> documentation for detailed information on how to set up a <a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> run, which is outside the scope of this vignette.</p>
<p>For example, let’s load up the example <a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> dataset stored internally in the package.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">upload_dir &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/bcbio"</span>, <span class="dt">package =</span> <span class="st">"bcbioRNASeq"</span>)</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(upload_dir))</a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(upload_dir)</a></code></pre></div>
<pre><code>## [1] "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"</code></pre>
<p><a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> outputs RNA-seq data in a standardized directory structure, which is described in detail in our <a href="http://dx.doi.org/10.12688/f1000research.12093.2">workflow paper</a>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="dt">path =</span> upload_dir, <span class="dt">full.names =</span> <span class="ot">FALSE</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##  [1] "2017-05-23_rnaseq/bcbio-nextgen-commands.log"
##  [2] "2017-05-23_rnaseq/bcbio-nextgen.log"         
##  [3] "2017-05-23_rnaseq/combined.counts"           
##  [4] "2017-05-23_rnaseq/programs.txt"              
##  [5] "2017-05-23_rnaseq/project-summary.yaml"      
##  [6] "2017-05-23_rnaseq/tx2gene.csv"               
##  [7] "group1_1/salmon/quant.sf"                    
##  [8] "group1_2/salmon/quant.sf"                    
##  [9] "group2_1/salmon/quant.sf"                    
## [10] "group2_2/salmon/quant.sf"                    
## [11] "sample_metadata.csv"</code></pre>
</div>
<div id="counts-level" class="section level2">
<h2 class="hasAnchor">
<a href="#counts-level" class="anchor"></a>Counts level</h2>
<p>By default, <a href="http://bioinformatics.sph.harvard.edu/bcbioRNASeq">bcbioRNASeq</a> imports counts at gene level, which are required for standard differential expression analysis (<code>level = "genes"</code>). For pseudo-aligned counts (e.g. <a href="https://combine-lab.github.io/salmon">Salmon</a>, <a href="https://pachterlab.github.io/kallisto">Kallisto</a>, <a href="http://www.cs.cmu.edu/~ckingsf/software/sailfish">Sailfish</a>) <span class="citation">(Bray et al. 2016; Patro, Mount, and Kingsford 2014; Patro et al. 2017)</span>, <a href="https://doi.org/doi:10.18129/B9.bioc.tximport">tximport</a> <span class="citation">(Soneson, Love, and Robinson 2016)</span> is used internally to aggregate transcript-level counts to gene-level counts, and generates length-scaled transcripts per million (TPM) values. For aligned counts processed with <a href="http://bioinf.wehi.edu.au/featureCounts">featureCounts</a> <span class="citation">(Liao, Smyth, and Shi 2014)</span> (e.g. <a href="https://github.com/alexdobin/STAR">STAR</a>, <a href="https://ccb.jhu.edu/software/hisat2">HISAT2</a>) <span class="citation">(Dobin et al. 2013; Dobin and Gingeras 2016; Kim, Langmead, and Salzberg 2015)</span>, these values are already returned at gene level, and therefore not handled by <a href="https://doi.org/doi:10.18129/B9.bioc.tximport">tximport</a>. Once the gene-level counts are imported during the <code><a href="../reference/bcbioRNASeq.html">bcbioRNASeq()</a></code> call, the <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a> package <span class="citation">(Love, Huber, and Anders 2014)</span> is then used to generate an internal <code>DESeqDataSet</code> from which we derive normalized and variance-stabilized counts.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">bcb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(<span class="dt">uploadDir =</span> upload_dir, <span class="dt">level =</span> <span class="st">"genes"</span>)</a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bcb)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 502 4 
## metadata(27): version level ... wd sessionInfo
## assays(5): counts tpm length normalized vst
## rownames(502): ENSMUSG00000002459 ENSMUSG00000004768 ...
##   ENSMUSG00000104523 ENSMUSG00000105982
## rowData names(0):
## colnames(4): group1_1 group1_2 group2_1 group2_2
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "genes"
## Caller: "salmon"
## Organism: character(0)
## Interesting Groups: "sampleName"</code></pre>
<p>Alternatively, if you want to perform transcript-aware analysis, such as differential exon usage or splicing analysis, transcript-level counts can be obtained using <code>level = "transcripts"</code>. Note that when counts are loaded at transcript level, TPMs are generated with <a href="https://doi.org/doi:10.18129/B9.bioc.tximport">tximport</a> internally, but no additional normalizations or transformations normally calculated for gene-level counts with <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a> are generated.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">bcb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(<span class="dt">uploadDir =</span> upload_dir, <span class="dt">level =</span> <span class="st">"transcripts"</span>)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bcb)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 996 4 
## metadata(27): version level ... wd sessionInfo
## assays(3): counts tpm length
## rownames(996): ENSMUST00000002533 ENSMUST00000006037 ...
##   ENSMUST00000208793 ENSMUST00000209020
## rowData names(0):
## colnames(4): group1_1 group1_2 group2_1 group2_2
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "transcripts"
## Caller: "salmon"
## Organism: character(0)
## Interesting Groups: "sampleName"</code></pre>
</div>
<div id="expression-callers" class="section level2">
<h2 class="hasAnchor">
<a href="#expression-callers" class="anchor"></a>Expression callers</h2>
<p>Since <a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> is flexible and supports a number of expression callers, we have provided advanced options in the <code><a href="../reference/bcbioRNASeq.html">bcbioRNASeq()</a></code> constructor to support a variety of workflows using the <code>caller</code> argument.</p>
<p><a href="https://combine-lab.github.io/salmon">Salmon</a>, <a href="https://pachterlab.github.io/kallisto">Kallisto</a>, and <a href="http://www.cs.cmu.edu/~ckingsf/software/sailfish">Sailfish</a> counts are supported at either gene or transcript level. Internally, these are loaded using <a href="https://doi.org/doi:10.18129/B9.bioc.tximport">tximport</a>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">salmon_genes &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(<span class="dt">uploadDir =</span> upload_dir, <span class="dt">caller =</span> <span class="st">"salmon"</span>)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(salmon_genes)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 502 4 
## metadata(27): version level ... wd sessionInfo
## assays(5): counts tpm length normalized vst
## rownames(502): ENSMUSG00000002459 ENSMUSG00000004768 ...
##   ENSMUSG00000104523 ENSMUSG00000105982
## rowData names(0):
## colnames(4): group1_1 group1_2 group2_1 group2_2
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "genes"
## Caller: "salmon"
## Organism: character(0)
## Interesting Groups: "sampleName"</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">assayNames</span>(salmon_genes)</a></code></pre></div>
<pre><code>## [1] "counts"     "tpm"        "length"     "normalized" "vst"</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">salmon_tx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(<span class="dt">uploadDir =</span> upload_dir, <span class="dt">level =</span> <span class="st">"transcripts"</span>)</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(salmon_tx)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 996 4 
## metadata(27): version level ... wd sessionInfo
## assays(3): counts tpm length
## rownames(996): ENSMUST00000002533 ENSMUST00000006037 ...
##   ENSMUST00000208793 ENSMUST00000209020
## rowData names(0):
## colnames(4): group1_1 group1_2 group2_1 group2_2
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "transcripts"
## Caller: "salmon"
## Organism: character(0)
## Interesting Groups: "sampleName"</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">assayNames</span>(salmon_tx)</a></code></pre></div>
<pre><code>## [1] "counts" "tpm"    "length"</code></pre>
<p><a href="https://github.com/alexdobin/STAR">STAR</a> and <a href="https://ccb.jhu.edu/software/hisat2">HISAT2</a> aligned counts processed with <a href="http://bioinf.wehi.edu.au/featureCounts">featureCounts</a> are also supported, but only at gene level.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">star &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(<span class="dt">uploadDir =</span> upload_dir, <span class="dt">caller =</span> <span class="st">"star"</span>)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(star)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 999 4 
## metadata(26): version level ... wd sessionInfo
## assays(3): counts normalized vst
## rownames(999): ENSMUSG00000001138 ENSMUSG00000001143 ...
##   ENSMUSG00000109048 ENSMUSG00000109510
## rowData names(0):
## colnames(4): group1_1 group1_2 group2_1 group2_2
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "genes"
## Caller: "star"
## Organism: character(0)
## Interesting Groups: "sampleName"</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">assayNames</span>(star)</a></code></pre></div>
<pre><code>## [1] "counts"     "normalized" "vst"</code></pre>
</div>
<div id="sample-selection-and-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-selection-and-metadata" class="anchor"></a>Sample selection and metadata</h2>
<p>If you’d like to load up only a subset of samples, this can be done easily using the <code>samples</code> argument. Note that the <code>character</code> vector declared here must match the <code>description</code> column specified in the sample metadata. For example, let’s create a <code>bcbioRNASeq</code> object containing only the <code>group1_1</code> and <code>group1_2</code> samples.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">bcb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">    <span class="dt">uploadDir =</span> upload_dir,</a>
<a class="sourceLine" id="cb53-3" data-line-number="3">    <span class="dt">samples =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"group1_1"</span>, <span class="st">"group1_2"</span>)</a>
<a class="sourceLine" id="cb53-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb53-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bcb)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 502 2 
## metadata(27): version level ... wd sessionInfo
## assays(5): counts tpm length normalized vst
## rownames(502): ENSMUSG00000002459 ENSMUSG00000004768 ...
##   ENSMUSG00000104523 ENSMUSG00000105982
## rowData names(0):
## colnames(2): group1_1 group1_2
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "genes"
## Caller: "salmon"
## Organism: character(0)
## Interesting Groups: "sampleName"</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw">sampleNames</span>(bcb)</a></code></pre></div>
<pre><code>##   group1_1   group1_2 
## "group1_1" "group1_2"</code></pre>
<p>Conversely, if you’re working with a large dataset and you simply want to drop a few samples, this can be accomplished with the <code>censorSamples</code> argument. Note that the <code>samples</code> argument takes priority if both are declared. For example, let’s drop the <code>group2_2</code> sample from our minimal dataset.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">bcb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">    <span class="dt">uploadDir =</span> upload_dir,</a>
<a class="sourceLine" id="cb57-3" data-line-number="3">    <span class="dt">censorSamples =</span> <span class="st">"group2_2"</span></a>
<a class="sourceLine" id="cb57-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb57-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bcb)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 502 3 
## metadata(27): version level ... wd sessionInfo
## assays(5): counts tpm length normalized vst
## rownames(502): ENSMUSG00000002459 ENSMUSG00000004768 ...
##   ENSMUSG00000104523 ENSMUSG00000105982
## rowData names(0):
## colnames(3): group1_1 group1_2 group2_1
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "genes"
## Caller: "salmon"
## Organism: character(0)
## Interesting Groups: "sampleName"</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">sampleNames</span>(bcb)</a></code></pre></div>
<pre><code>##   group1_1   group1_2   group2_1 
## "group1_1" "group1_2" "group2_1"</code></pre>
<p>If you’re working with a bcbio run that has incorrect or outdated metadata, the simplest way to fix this issue is to pass in new metadata from an external spreadsheet (CSV or Excel) using the <code>sampleMetadataFile</code> argument. Note that this can also be used to subset the bcbio dataset, similar to the <code>samples</code> argument (see above), based on the rows that are included in the spreadsheet.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">sample_metadata_file &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(upload_dir, <span class="st">"sample_metadata.csv"</span>)</a>
<a class="sourceLine" id="cb61-2" data-line-number="2">bcb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(</a>
<a class="sourceLine" id="cb61-3" data-line-number="3">    <span class="dt">uploadDir =</span> upload_dir,</a>
<a class="sourceLine" id="cb61-4" data-line-number="4">    <span class="dt">sampleMetadataFile =</span> sample_metadata_file</a>
<a class="sourceLine" id="cb61-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb61-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bcb)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 502 4 
## metadata(27): version level ... wd sessionInfo
## assays(5): counts tpm length normalized vst
## rownames(502): ENSMUSG00000002459 ENSMUSG00000004768 ...
##   ENSMUSG00000104523 ENSMUSG00000105982
## rowData names(0):
## colnames(4): group1_1 group1_2 group2_1 group2_2
## colData names(22): sampleName fileName ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "genes"
## Caller: "salmon"
## Organism: character(0)
## Interesting Groups: "sampleName"
## Metadata File: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio/sample_metadata.csv"</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw">sampleData</span>(bcb, <span class="dt">clean =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## DataFrame with 4 rows and 5 columns
##          sampleName             fileName    group sequenceLength
##            &lt;factor&gt;             &lt;factor&gt; &lt;factor&gt;       &lt;factor&gt;
## group1_1   group1_1 group1_1_R1.fastq.gz     ctrl          25-75
## group1_2   group1_2 group1_2_R1.fastq.gz     ctrl          25-75
## group2_1   group2_1 group2_1_R1.fastq.gz       ko          25-75
## group2_2   group2_2 group2_2_R1.fastq.gz       ko          25-75
##          interestingGroups
##                   &lt;factor&gt;
## group1_1          group1_1
## group1_2          group1_2
## group2_1          group2_1
## group2_2          group2_2</code></pre>
</div>
<div id="genome-annotations" class="section level2">
<h2 class="hasAnchor">
<a href="#genome-annotations" class="anchor"></a>Genome annotations</h2>
<p>When analyzing a dataset against a well-annotated genome, we recommend importing the corresponding metadata using <a href="https://doi.org/doi:10.18129/B9.bioc.AnnotationHub">AnnotationHub</a> and <a href="https://doi.org/doi:10.18129/B9.bioc.ensembldb">ensembldb</a>. This functionality is natively supported in the <code><a href="../reference/bcbioRNASeq.html">bcbioRNASeq()</a></code> constructor with using the <code>organism</code>, <code>ensemblRelease</code>, and <code>genomeBuild</code> arguments. This will return a <code>GRanges</code> object using the <a href="https://doi.org/doi:10.18129/B9.bioc.GenomicRanges">GenomicRanges</a> package <span class="citation">(Lawrence et al. 2013)</span>, which contains coordinates and rich metadata for each gene or transcript. These annotations are accessible with the <code>rowRanges()</code> and <code>rowData()</code> functions defined in the <a href="https://doi.org/doi:10.18129/B9.bioc.SummarizedExperiment">SummarizedExperiment</a> package <span class="citation">(Huber et al. 2015)</span>.</p>
<p>For example, with our internal <a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> dataset, we’re analyzing counts generated against the <a href="https://www.ensembl.org">Ensembl</a> <em>Mus musculus</em> GRCm38 genome build (release 87). These parameters can be defined in the object load call to ensure that the annotations match up exactly with the genome used.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">bcb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(</a>
<a class="sourceLine" id="cb65-2" data-line-number="2">    <span class="dt">uploadDir =</span> upload_dir,</a>
<a class="sourceLine" id="cb65-3" data-line-number="3">    <span class="dt">level =</span> <span class="st">"genes"</span>,</a>
<a class="sourceLine" id="cb65-4" data-line-number="4">    <span class="dt">organism =</span> <span class="st">"Mus musculus"</span>,</a>
<a class="sourceLine" id="cb65-5" data-line-number="5">    <span class="dt">genomeBuild =</span> <span class="st">"GRCm38"</span>,</a>
<a class="sourceLine" id="cb65-6" data-line-number="6">    <span class="dt">ensemblRelease =</span> <span class="dv">87</span></a>
<a class="sourceLine" id="cb65-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb65-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bcb)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 502 4 
## metadata(28): version level ... wd sessionInfo
## assays(5): counts tpm length normalized vst
## rownames(502): ENSMUSG00000002459 ENSMUSG00000004768 ...
##   ENSMUSG00000104523 ENSMUSG00000105982
## rowData names(7): broadClass description ... geneName
##   seqCoordSystem
## colnames(4): group1_1 group1_2 group2_1 group2_2
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "genes"
## Caller: "salmon"
## Organism: "Mus musculus"
## Interesting Groups: "sampleName"
## AnnotationHub: character(0)
## Ensembl Release: "87"
## Genome Build: "GRCm38"</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw">metadata</span>(bcb)<span class="op">$</span>rowRangesMetadata</a></code></pre></div>
<pre><code>##                  name                               value
## 1             Db type                               EnsDb
## 2     Type of Gene ID                     Ensembl Gene ID
## 3  Supporting package                           ensembldb
## 4       Db created by ensembldb package from Bioconductor
## 5      script_version                               0.3.1
## 6       Creation time            Fri Jun  9 08:40:26 2017
## 7     ensembl_version                                  87
## 8        ensembl_host                           localhost
## 9            Organism                        mus_musculus
## 10        taxonomy_id                               10090
## 11       genome_build                              GRCm38
## 12    DBSCHEMAVERSION                                 2.1</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">rowRanges</span>(bcb) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>()</a></code></pre></div>
<pre><code>## 'data.frame':    502 obs. of  12 variables:
##  $ seqnames      : Factor w/ 86 levels "3","X","16","7",..: 19 19 19 19 19 19 19 19 19 19 ...
##  $ start         : int  4909576 33719887 13139105 12692277 18115191 17727045 17145362 16688051 3999557 4490931 ...
##  $ end           : int  5070285 33742564 13374083 12861192 18145902 17766344 17164271 16709611 4409241 4497354 ...
##  $ width         : int  160710 22678 234979 168916 30712 39300 18910 21561 409685 6424 ...
##  $ strand        : Factor w/ 3 levels "+","-","*": 2 1 2 1 2 1 1 1 2 2 ...
##  $ broadClass    : Factor w/ 8 levels "coding","ig",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ description   : Factor w/ 48309 levels "1-acylglycerol-3-phosphate O-acyltransferase 1 (lysophosphatidic acid acyltransferase, alpha) [Source:MGI Symbo"| __truncated__,..: 38543 38220 12845 44134 3740 3741 6373 9508 38694 43955 ...
##  $ entrezID      :List of 502
##   ..$ ENSMUSG00000002459: int 58175
##   ..$ ENSMUSG00000004768: int 19335
##   ..$ ENSMUSG00000005886: int 17978
##   ..$ ENSMUSG00000016918: int 240725
##   ..$ ENSMUSG00000025774: int 78081
##   ..$ ENSMUSG00000025776: int 83691
##   ..$ ENSMUSG00000025777: int 14545
##   ..$ ENSMUSG00000025779: int 17087
##   ..$ ENSMUSG00000025900: int 19888
##   ..$ ENSMUSG00000025902: int 20671
##   ..$ ENSMUSG00000025903: int 18777
##   ..$ ENSMUSG00000025905: int 18387
##   ..$ ENSMUSG00000025907: int 12421
##   ..$ ENSMUSG00000025909: int 71096
##   ..$ ENSMUSG00000025911: int 76187
##   ..$ ENSMUSG00000025912: int 17864
##   ..$ ENSMUSG00000025915: int 170755
##   ..$ ENSMUSG00000025916: int 69312
##   ..$ ENSMUSG00000025917: int 26754
##   ..$ ENSMUSG00000025920: int 29819
##   ..$ ENSMUSG00000025921: int 98711
##   ..$ ENSMUSG00000025925: int 21749
##   ..$ ENSMUSG00000025927: int 21419
##   ..$ ENSMUSG00000025929: int 16171
##   ..$ ENSMUSG00000025930: int 17681
##   ..$ ENSMUSG00000025931: int 74229
##   ..$ ENSMUSG00000025932: int 14048
##   ..$ ENSMUSG00000025933: int 75712
##   ..$ ENSMUSG00000025934: int 14859
##   ..$ ENSMUSG00000025935: int 72265
##   ..$ ENSMUSG00000025936: int NA
##   ..$ ENSMUSG00000025937: int 212442
##   ..$ ENSMUSG00000025938: int 240726
##   ..$ ENSMUSG00000025939: int 66799
##   ..$ ENSMUSG00000025940: int 70397
##   ..$ ENSMUSG00000026058: int 170771
##   ..$ ENSMUSG00000026063: int 74708
##   ..$ ENSMUSG00000026064: int 19243
##   ..$ ENSMUSG00000026123: int 226971
##   ..$ ENSMUSG00000026124: int 12627
##   ..$ ENSMUSG00000026125: int 21755
##   ..$ ENSMUSG00000026126: int 19253
##   ..$ ENSMUSG00000026127: int 27993
##   ..$ ENSMUSG00000026131: int 13518
##   ..$ ENSMUSG00000026134: int 19076
##   ..$ ENSMUSG00000026141: int 12823
##   ..$ ENSMUSG00000026147: int 12839
##   ..$ ENSMUSG00000026153: int 68187
##   ..$ ENSMUSG00000026154: int 68002
##   ..$ ENSMUSG00000026155: int 98366
##   ..$ ENSMUSG00000026156: int 280645
##   ..$ ENSMUSG00000026158: int 70155
##   ..$ ENSMUSG00000028033: int 226922
##   ..$ ENSMUSG00000032719: int 226866
##   ..$ ENSMUSG00000032769: int 277328
##   ..$ ENSMUSG00000033569: int 210933
##   ..$ ENSMUSG00000033740: int 240690
##   ..$ ENSMUSG00000033774: int 226304
##   ..$ ENSMUSG00000033793: int 108664
##   ..$ ENSMUSG00000033813: int 21399
##   ..$ ENSMUSG00000033845: int 27395
##   ..$ ENSMUSG00000037503: int 214469
##   ..$ ENSMUSG00000037509: int 226970
##   ..$ ENSMUSG00000037529: int 21756
##   ..$ ENSMUSG00000041670: int NA
##   ..$ ENSMUSG00000041722: int 433278
##   ..$ ENSMUSG00000041779: int 170829
##   ..$ ENSMUSG00000041809: int 71877
##   ..$ ENSMUSG00000041859: int 17215
##   ..$ ENSMUSG00000041872: int 257630
##   ..$ ENSMUSG00000042111: int 69668
##   ..$ ENSMUSG00000042182: int 320705
##   ..$ ENSMUSG00000042197: int 98403
##   ..$ ENSMUSG00000042215: int 213539
##   ..$ ENSMUSG00000042414: int 383491
##   ..$ ENSMUSG00000042501: int 329093
##   ..$ ENSMUSG00000042596: int 226896
##   ..$ ENSMUSG00000042686: int 57339
##   ..$ ENSMUSG00000043716: int 19989
##   ..$ ENSMUSG00000043760: int 241035
##   ..$ ENSMUSG00000045174: int 211383
##   ..$ ENSMUSG00000045210: int 70675
##   ..$ ENSMUSG00000045216: int 50785
##   ..$ ENSMUSG00000045815: int NA
##   ..$ ENSMUSG00000046101: int 240697
##   ..$ ENSMUSG00000046334: int NA
##   ..$ ENSMUSG00000048411: int 210962
##   ..$ ENSMUSG00000048538: int NA
##   ..$ ENSMUSG00000048874: int 213109
##   ..$ ENSMUSG00000048960: int 109294
##   ..$ ENSMUSG00000050217: int 266744
##   ..$ ENSMUSG00000051285: int 319263
##   ..$ ENSMUSG00000051951: int 497097
##   ..$ ENSMUSG00000053185: int NA
##   ..$ ENSMUSG00000054493: int NA
##   ..$ ENSMUSG00000056763: int 211660
##   ..$ ENSMUSG00000057715: int 320492
##   ..$ ENSMUSG00000058590: int NA
##   ..$ ENSMUSG00000061024: int 59014
##   .. [list output truncated]
##   ..- attr(*, "class")= chr "AsIs"
##  $ geneBiotype   : Factor w/ 44 levels "3prime_overlapping_ncRNA",..: 22 22 22 22 22 22 22 22 22 22 ...
##  $ geneID        : chr  "ENSMUSG00000002459" "ENSMUSG00000004768" "ENSMUSG00000005886" "ENSMUSG00000016918" ...
##  $ geneName      : Factor w/ 49845 levels "-343C11.2","00R_AC107638.2",..: 41559 41127 37032 45836 6280 6281 9198 34206 41866 45309 ...
##  $ seqCoordSystem: Factor w/ 2 levels "chromosome","scaffold": 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>Alternatively, transcript-level annotations can also be obtained automatically using this method.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">bcb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(</a>
<a class="sourceLine" id="cb71-2" data-line-number="2">    <span class="dt">uploadDir =</span> upload_dir,</a>
<a class="sourceLine" id="cb71-3" data-line-number="3">    <span class="dt">level =</span> <span class="st">"transcripts"</span>,</a>
<a class="sourceLine" id="cb71-4" data-line-number="4">    <span class="dt">organism =</span> <span class="st">"Mus musculus"</span>,</a>
<a class="sourceLine" id="cb71-5" data-line-number="5">    <span class="dt">genomeBuild =</span> <span class="st">"GRCm38"</span>,</a>
<a class="sourceLine" id="cb71-6" data-line-number="6">    <span class="dt">ensemblRelease =</span> <span class="dv">87</span></a>
<a class="sourceLine" id="cb71-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb71-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bcb)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 996 4 
## metadata(28): version level ... wd sessionInfo
## assays(3): counts tpm length
## rownames(996): ENSMUST00000002533 ENSMUST00000006037 ...
##   ENSMUST00000208793 ENSMUST00000209020
## rowData names(13): broadClass description ... transcriptName
##   transcriptSupportLevel
## colnames(4): group1_1 group1_2 group2_1 group2_2
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "transcripts"
## Caller: "salmon"
## Organism: "Mus musculus"
## Interesting Groups: "sampleName"
## AnnotationHub: character(0)
## Ensembl Release: "87"
## Genome Build: "GRCm38"</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">rowRanges</span>(bcb) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>()</a></code></pre></div>
<pre><code>## 'data.frame':    996 obs. of  18 variables:
##  $ seqnames              : Factor w/ 86 levels "3","X","11","16",..: 15 15 15 15 15 15 15 15 15 15 ...
##  $ start                 : int  4909576 13142475 33761545 18115191 17145362 16688433 4344146 4490931 4807823 5588557 ...
##  $ end                   : int  5019539 13374083 33814527 18145902 17164271 16709611 4360314 4496413 4846739 5602866 ...
##  $ width                 : int  109964 231609 52983 30712 18910 21179 16169 5483 38917 14310 ...
##  $ strand                : Factor w/ 3 levels "+","-","*": 2 2 2 2 1 1 2 2 1 1 ...
##  $ broadClass            : Factor w/ 9 levels "coding","decaying",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ description           : Factor w/ 48309 levels "1-acylglycerol-3-phosphate O-acyltransferase 1 (lysophosphatidic acid acyltransferase, alpha) [Source:MGI Symbo"| __truncated__,..: 38543 12845 47868 3740 6373 9508 38694 43955 9573 14537 ...
##  $ entrezID              :List of 996
##   ..$ ENSMUSG00000002459: int 58175
##   ..$ ENSMUSG00000005886: int 17978
##   ..$ ENSMUSG00000042197: int 98403
##   ..$ ENSMUSG00000025774: int 78081
##   ..$ ENSMUSG00000025777: int 14545
##   ..$ ENSMUSG00000025779: int 17087
##   ..$ ENSMUSG00000025900: int 19888
##   ..$ ENSMUSG00000025902: int 20671
##   ..$ ENSMUSG00000025903: int 18777
##   ..$ ENSMUSG00000025905: int 18387
##   ..$ ENSMUSG00000025907: int 12421
##   ..$ ENSMUSG00000025911: int 76187
##   ..$ ENSMUSG00000025916: int 69312
##   ..$ ENSMUSG00000025917: int 26754
##   ..$ ENSMUSG00000025920: int 29819
##   ..$ ENSMUSG00000025921: int 98711
##   ..$ ENSMUSG00000048960: int 109294
##   ..$ ENSMUSG00000025925: int 21749
##   ..$ ENSMUSG00000025927: int 21419
##   ..$ ENSMUSG00000025929: int 16171
##   ..$ ENSMUSG00000025930: int 17681
##   ..$ ENSMUSG00000025933: int 75712
##   ..$ ENSMUSG00000025933: int 75712
##   ..$ ENSMUSG00000025932: int 14048
##   ..$ ENSMUSG00000025934: int 14859
##   ..$ ENSMUSG00000025935: int 72265
##   ..$ ENSMUSG00000025937: int 212442
##   ..$ ENSMUSG00000026058: int 170771
##   ..$ ENSMUSG00000026063: int 74708
##   ..$ ENSMUSG00000026064: int 19243
##   ..$ ENSMUSG00000026123: int 226971
##   ..$ ENSMUSG00000026124: int 12627
##   ..$ ENSMUSG00000026125: int 21755
##   ..$ ENSMUSG00000026126: int 19253
##   ..$ ENSMUSG00000026127: int 27993
##   ..$ ENSMUSG00000026134: int 19076
##   ..$ ENSMUSG00000026153: int 68187
##   ..$ ENSMUSG00000026154: int 68002
##   ..$ ENSMUSG00000026155: int 98366
##   ..$ ENSMUSG00000026158: int 70155
##   ..$ ENSMUSG00000048538: int NA
##   ..$ ENSMUSG00000028033: int 226922
##   ..$ ENSMUSG00000042501: int 329093
##   ..$ ENSMUSG00000042596: int 226896
##   ..$ ENSMUSG00000041779: int 170829
##   ..$ ENSMUSG00000042686: int 57339
##   ..$ ENSMUSG00000041809: int 71877
##   ..$ ENSMUSG00000041872: int 257630
##   ..$ ENSMUSG00000101571: int NA
##   ..$ ENSMUSG00000032719: int 226866
##   ..$ ENSMUSG00000032769: int 277328
##   ..$ ENSMUSG00000033569: int 210933
##   ..$ ENSMUSG00000042111: int 69668
##   ..$ ENSMUSG00000033740: int 240690
##   ..$ ENSMUSG00000033774: int 226304
##   ..$ ENSMUSG00000033793: int 108664
##   ..$ ENSMUSG00000042197: int 98403
##   ..$ ENSMUSG00000042215: int 213539
##   ..$ ENSMUSG00000033845: int 27395
##   ..$ ENSMUSG00000037503: int 214469
##   ..$ ENSMUSG00000042414: int 383491
##   ..$ ENSMUSG00000037509: int 226970
##   ..$ ENSMUSG00000037529: int 21756
##   ..$ ENSMUSG00000057715: int 320492
##   ..$ ENSMUSG00000026141: int 12823
##   ..$ ENSMUSG00000045174: int 211383
##   ..$ ENSMUSG00000046101: int 240697
##   ..$ ENSMUSG00000041859: int 17215
##   ..$ ENSMUSG00000026147: int 12839
##   ..$ ENSMUSG00000025920: int 29819
##   ..$ ENSMUSG00000045210: int 70675
##   ..$ ENSMUSG00000043716: int 19989
##   ..$ ENSMUSG00000069620: int NA
##   ..$ ENSMUSG00000048411: int 210962
##   ..$ ENSMUSG00000051285: int 319263
##   ..$ ENSMUSG00000042182: int 320705
##   ..$ ENSMUSG00000045815: int NA
##   ..$ ENSMUSG00000050217: int 266744
##   ..$ ENSMUSG00000046334: int NA
##   ..$ ENSMUSG00000026156: int 280645
##   ..$ ENSMUSG00000025927: int 21419
##   ..$ ENSMUSG00000025940: int 70397
##   ..$ ENSMUSG00000053185: int NA
##   ..$ ENSMUSG00000054493: int NA
##   ..$ ENSMUSG00000005886: int 17978
##   ..$ ENSMUSG00000025931: int 74229
##   ..$ ENSMUSG00000041722: int 433278
##   ..$ ENSMUSG00000051951: int 497097
##   ..$ ENSMUSG00000056763: int 211660
##   ..$ ENSMUSG00000091020: int NA
##   ..$ ENSMUSG00000061024: int 59014
##   ..$ ENSMUSG00000073730: int 66755
##   ..$ ENSMUSG00000026064: int 19243
##   ..$ ENSMUSG00000062588: int NA
##   ..$ ENSMUSG00000025932: int 14048
##   ..$ ENSMUSG00000058590: int NA
##   ..$ ENSMUSG00000041670: int NA
##   ..$ ENSMUSG00000033813: int 21399
##   ..$ ENSMUSG00000005886: int 17978
##   .. [list output truncated]
##   ..- attr(*, "class")= chr "AsIs"
##  $ geneBiotype           : Factor w/ 44 levels "3prime_overlapping_ncRNA",..: 22 22 22 22 22 22 22 22 22 22 ...
##  $ geneID                : Factor w/ 50143 levels "ENSMUSG00000000001",..: 434 913 12492 5185 5187 5188 5246 5247 5248 5249 ...
##  $ geneName              : Factor w/ 49845 levels "-343C11.2","00R_AC107638.2",..: 41559 37032 49448 6280 9198 34206 41866 45309 34221 39248 ...
##  $ seqCoordSystem        : Factor w/ 2 levels "chromosome","scaffold": 1 1 1 1 1 1 1 1 1 1 ...
##  $ transcriptBiotype     : Factor w/ 48 levels "3prime_overlapping_ncRNA",..: 24 24 24 24 24 24 24 24 24 24 ...
##  $ transcriptCdsSeqEnd   : int  5019379 13224694 33814358 18145853 17161509 16709537 4352825 4493406 4845016 5602784 ...
##  $ transcriptCdsSeqStart : int  4910474 13142761 33762163 18115629 17145472 16688508 4344600 4491716 4807914 5589049 ...
##  $ transcriptID          : chr  "ENSMUST00000002533" "ENSMUST00000006037" "ENSMUST00000019861" "ENSMUST00000026876" ...
##  $ transcriptName        : chr  "ENSMUST00000002533" "ENSMUST00000006037" "ENSMUST00000019861" "ENSMUST00000026876" ...
##  $ transcriptSupportLevel: int  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>When working with a dataset generated against a poorly-annotated or non-standard genome, we provide a fallback method for loading gene annotations from a <a href="https://useast.ensembl.org/info/website/upload/gff.html">general feature format (GFF)</a> file with the <code>gffFile</code> argument. If possible, we recommend providing a general transfer format (GTF) file, which is identical to GFF version 2. GFFv3 is more complicated and non-standard, but <a href="https://www.ensembl.org">Ensembl</a> GFFv3 files are also supported.</p>
<p>If your dataset contains transgenes (e.g. EGFP, TDTOMATO) or spike-ins (e.g. ERCCs), these features can be defined with the <code>transgeneNames</code> and <code>spikeNames</code> arguments, which will automatically populate the <code>rowRanges()</code> slot with placeholder metadata.</p>
<p>We recommend loading up data per genome in its own <code>bcbioRNASeq</code> object when possible, so that rich metadata can be imported easily. In the edge case where you need to look at multiple genomes simultaneously, set <code>organism = NULL</code>, and bcbioRNASeq will skip the gene annotation acquisition step.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">bcb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(<span class="dt">uploadDir =</span> upload_dir, <span class="dt">organism =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bcb)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.10
## class: RangedSummarizedExperiment 
## dim: 502 4 
## metadata(27): version level ... wd sessionInfo
## assays(5): counts tpm length normalized vst
## rownames(502): ENSMUSG00000002459 ENSMUSG00000004768 ...
##   ENSMUSG00000104523 ENSMUSG00000105982
## rowData names(0):
## colnames(4): group1_1 group1_2 group2_1 group2_2
## colData names(21): sampleName description ... totalReads x5x3Bias
## Upload Dir: "/Users/mike/R/x86_64-apple-darwin15.6.0-library/3.6/bcbioRNASeq/extdata/bcbio"
## Upload Date: 2017-05-23
## R Load Date: 2019-05-13
## Level: "genes"
## Caller: "salmon"
## Organism: character(0)
## Interesting Groups: "sampleName"</code></pre>
</div>
<div id="variance-stabilization" class="section level2">
<h2 class="hasAnchor">
<a href="#variance-stabilization" class="anchor"></a>Variance stabilization</h2>
<p>During the <code><a href="../reference/bcbioRNASeq.html">bcbioRNASeq()</a></code> constructor call, variance stabilizaton of gene-level counts can be calculated automatically, and is recommended. This is performed internally by the <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a> package. These transformations will be slotted into <code>assays()</code> as <code>vst</code> and/or <code>rlog</code> matrices. The <code>vst</code> matrix is calculated by <code><a href="https://rdrr.io/pkg/DESeq2/man/varianceStabilizingTransformation.html">DESeq2::varianceStabilizingTransformation()</a></code> and <code>rlog</code> by <code><a href="https://rdrr.io/pkg/DESeq2/man/rlog.html">DESeq2::rlog()</a></code>. For large datasets, <code>rlog</code> calculation can take a long time, so we are currently recommending calculation of only <code>vst</code> by default.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">bcb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(</a>
<a class="sourceLine" id="cb77-2" data-line-number="2">    <span class="dt">uploadDir =</span> upload_dir,</a>
<a class="sourceLine" id="cb77-3" data-line-number="3">    <span class="dt">vst =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb77-4" data-line-number="4">    <span class="dt">rlog =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb77-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb77-6" data-line-number="6"><span class="kw">assayNames</span>(bcb)</a></code></pre></div>
<pre><code>## [1] "counts"     "tpm"        "length"     "normalized" "vst"       
## [6] "rlog"</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw"><a href="../reference/counts.html">counts</a></span>(bcb, <span class="dt">normalized =</span> <span class="st">"vst"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>()</a></code></pre></div>
<pre><code>##     group1_1         group1_2         group2_1         group2_2     
##  Min.   : 5.708   Min.   : 5.708   Min.   : 5.708   Min.   : 5.708  
##  1st Qu.: 5.708   1st Qu.: 5.708   1st Qu.: 5.708   1st Qu.: 5.708  
##  Median : 5.708   Median : 5.708   Median : 5.708   Median : 5.708  
##  Mean   : 6.506   Mean   : 6.506   Mean   : 6.518   Mean   : 6.504  
##  3rd Qu.: 6.296   3rd Qu.: 6.260   3rd Qu.: 6.289   3rd Qu.: 6.261  
##  Max.   :17.081   Max.   :17.331   Max.   :17.334   Max.   :17.438</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="kw"><a href="../reference/counts.html">counts</a></span>(bcb, <span class="dt">normalized =</span> <span class="st">"rlog"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>()</a></code></pre></div>
<pre><code>##     group1_1         group1_2         group2_1         group2_2     
##  Min.   :-1.726   Min.   :-1.727   Min.   :-1.728   Min.   :-1.727  
##  1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.: 0.000  
##  Median : 0.000   Median : 0.000   Median : 0.000   Median : 0.000  
##  Mean   : 1.884   Mean   : 1.887   Mean   : 1.888   Mean   : 1.884  
##  3rd Qu.: 2.985   3rd Qu.: 2.969   3rd Qu.: 2.950   3rd Qu.: 2.979  
##  Max.   :17.130   Max.   :17.322   Max.   :17.325   Max.   :17.405</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(bcb)</a></code></pre></div>
</div>
</div>
<div id="use-case-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#use-case-dataset" class="anchor"></a>Use case dataset</h1>
<p>To demonstrate the functionality and configuration of the package, we have taken an experiment from the <a href="https://www.ncbi.nlm.nih.gov/geo">Gene Expression Omnibus (GEO)</a> public repository of expression data to use as an example use case. The RNA-seq data is from a study of acute kidney injury in a mouse model (<a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE65267">GSE65267</a>) <span class="citation">(Craciun et al. 2016)</span>. The study aims to identify differentially expressed genes in progressive kidney fibrosis and contains samples from mouse kidneys at several time points (n = 3, per time point) after folic acid treatment. From this dataset, we are using a subset of the samples for our use case: before folic acid treatment, and 1, 3, 7 days after treatment.</p>
<p>For the vignette, we are loading a pre-computed version of the example <code>bcbioRNASeq</code> object used in our <a href="http://dx.doi.org/10.12688/f1000research.12093.2">workflow paper</a>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="kw">loadRemoteData</span>(<span class="st">"https://github.com/hbc/bcbioRNASeq/raw/f1000v2/data/bcb.rda"</span>)</a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bcb)</a></code></pre></div>
<pre><code>## bcbioRNASeq 0.2.4
## class: RangedSummarizedExperiment 
## dim: 51652 12 
## metadata(31): version level ... subset brio
## assays(6): counts tpm ... rlog vst
## rownames(51652): ENSMUSG00000000001 ENSMUSG00000000003 ...
##   ENSMUSG00000114967 ENSMUSG00000114968
## rowData names(7): geneID geneName ... entrezID broadClass
## colnames(12): control_rep1 control_rep2 ... fa_day7_rep2
##   fa_day7_rep3
## colData names(26): sampleName day ... x5x3Bias xGC
## Upload Dir: "/n/data1/cores/bcbio/bcbioRNASeq/F1000v2/GSE65267-merged/final"
## Upload Date: 2018-03-18
## R Load Date: 2018-06-01
## Level: "genes"
## Caller: "salmon"
## Organism: "Mus musculus"
## Interesting Groups: "day"
## AnnotationHub: "AH57770"
## Ensembl Release: "90"
## Genome Build: "GRCm38"</code></pre>
</div>
<div id="sample-metadata" class="section level1">
<h1 class="hasAnchor">
<a href="#sample-metadata" class="anchor"></a>Sample metadata</h1>
<p>For reference, let’s take a look at the sample metadata. By comparison, using <code>colData()</code> will return all sample-level metadata, including our quality control metrics generated by bcbio. We recommend instead using <code>sampleData()</code> with the <code>clean = TRUE</code> argument in reports, which only returns <code>factor</code> columns of interest.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">sampleData</span>(bcb, <span class="dt">clean =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## DataFrame with 12 rows and 7 columns
##                sampleName      day replicate   strain   tissue  treatment
##                  &lt;factor&gt; &lt;factor&gt;  &lt;factor&gt; &lt;factor&gt; &lt;factor&gt;   &lt;factor&gt;
## control_rep1 control_rep1        0         1   Balb/c   kidney    control
## control_rep2 control_rep2        0         2   Balb/c   kidney    control
## control_rep3 control_rep3        0         3   Balb/c   kidney    control
## fa_day1_rep1 fa_day1_rep1        1         1   Balb/c   kidney folic acid
## fa_day1_rep2 fa_day1_rep2        1         2   Balb/c   kidney folic acid
## ...                   ...      ...       ...      ...      ...        ...
## fa_day3_rep2 fa_day3_rep2        3         2   Balb/c   kidney folic acid
## fa_day3_rep3 fa_day3_rep3        3         3   Balb/c   kidney folic acid
## fa_day7_rep1 fa_day7_rep1        7         1   Balb/c   kidney folic acid
## fa_day7_rep2 fa_day7_rep2        7         2   Balb/c   kidney folic acid
## fa_day7_rep3 fa_day7_rep3        7         3   Balb/c   kidney folic acid
##              interestingGroups
##                       &lt;factor&gt;
## control_rep1                 0
## control_rep2                 0
## control_rep3                 0
## fa_day1_rep1                 1
## fa_day1_rep2                 1
## ...                        ...
## fa_day3_rep2                 3
## fa_day3_rep3                 3
## fa_day7_rep1                 7
## fa_day7_rep2                 7
## fa_day7_rep3                 7</code></pre>
</div>
<div id="interesting-groups" class="section level1">
<h1 class="hasAnchor">
<a href="#interesting-groups" class="anchor"></a>Interesting groups</h1>
<p>Groups of interest to be used for coloring and sample grouping in the quality control plots can be defined in the <code>bcbioRNASeq</code> object using the <code>interestingGroups</code> argument in the <code><a href="../reference/bcbioRNASeq.html">bcbioRNASeq()</a></code> constructor call. Assignment method support with the <code>interestingGroups()</code> function is also provided, which can modify the groups of interest after the object has been created.</p>
<p>The <code>interestingGroups</code> definition defaults to <code>sampleName</code>, which is automatically generated from the <a href="https://bcbio-nextgen.readthedocs.io">bcbio</a> <code>description</code> metadata for demultiplexed bulk RNA-seq samples. In this case, the samples will be grouped and colored uniquely.</p>
<p>Interesting groups must be defined using a <code>character</code> vector and refer to column names defined in the <code>colData()</code> slot of the object. Note that the <a href="http://bioinformatics.sph.harvard.edu/bcbioRNASeq">bcbioRNASeq</a> packages uses lower camel case formatting for column names (e.g. “sampleName”), so the interesting groups should be defined using camel case, not snake (e.g. “sample_name”) or dotted case (e.g. “sample.name”).</p>
<p>This approach was inspired by the <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a> package, which uses the argument <code>intgroup</code> in some functions, such as <code><a href="../reference/plotPCA.html">plotPCA()</a></code> for labeling groups of interest. We took this idea and ran with it for a number of our quality control functions, which are described in detail below.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="kw">interestingGroups</span>(bcb) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"treatment"</span>, <span class="st">"day"</span>)</a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="kw">interestingGroups</span>(bcb)</a></code></pre></div>
<pre><code>## [1] "treatment" "day"</code></pre>
</div>
<div id="quality-control" class="section level1">
<h1 class="hasAnchor">
<a href="#quality-control" class="anchor"></a>Quality control</h1>
<p>Our <a href="http://dx.doi.org/10.12688/f1000research.12093.2">workflow paper</a> describes our quality control process in detail. In addition, our <strong>Quality Control</strong> <a href="https://rmarkdown.rstudio.com">R Markdown</a> template contains notes detailing each metric. Here were are going into more technical detail regarding how to customize the appearance of the plots. Note that all quality control plotting functions inherit the <code>interestingGroups</code> defined inside the <code>bcbioRNASeq</code> object. You can also change this dynamially for each function call using the <code>interestingGroups</code> argument.</p>
<div id="read-counts" class="section level2">
<h2 class="hasAnchor">
<a href="#read-counts" class="anchor"></a>Read counts</h2>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw"><a href="../reference/plotTotalReads.html">plotTotalReads</a></span>(bcb)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw"><a href="../reference/plotMappedReads.html">plotMappedReads</a></span>(bcb)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-20-2.png" width="700"></p>
</div>
<div id="mapping-rates" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-rates" class="anchor"></a>Mapping rates</h2>
<p>Note that the overall mapping rate is relatively low per sample, while the exonic mapping rate is acceptable. High quality samples should have low intronic mapping rate, and high values are indicative of sample degradation and/or contamination.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw"><a href="../reference/plotMappingRate.html">plotMappingRate</a></span>(bcb)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw"><a href="../reference/plotExonicMappingRate.html">plotExonicMappingRate</a></span>(bcb)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-21-2.png" width="700"></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw"><a href="../reference/plotIntronicMappingRate.html">plotIntronicMappingRate</a></span>(bcb)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-21-3.png" width="700"></p>
</div>
<div id="rrna-mapping-rate" class="section level2">
<h2 class="hasAnchor">
<a href="#rrna-mapping-rate" class="anchor"></a>rRNA mapping rate</h2>
<p>Note that the samples here have a high rRNA mapping rate. This can be indicative of the polyA enrichment or ribo depletion protocol not having removed all ribosomal RNA (rRNA) transcripts. This will reduce the number of biologically meaningful reads in the experiment and is best avoided.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw"><a href="../reference/plotRRNAMappingRate.html">plotRRNAMappingRate</a></span>(bcb)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
<div id="bias" class="section level2">
<h2 class="hasAnchor">
<a href="#bias" class="anchor"></a>5’-&gt;3’ bias</h2>
<p>RNA-seq data can have specific biases at either the 5’ or 3’ end of sequenced fragments. It is common to see a small amount of bias, especially if polyA enrichment was performed, or if there is any sample degradation. If a large amount of bias is observed here, be sure to analyze the samples with a Bioanalyzer and check the RIN scores.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="kw"><a href="../reference/plot5Prime3PrimeBias.html">plot5Prime3PrimeBias</a></span>(bcb)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div id="gene-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#gene-distributions" class="anchor"></a>Gene distributions</h2>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="kw"><a href="../reference/plotGenesDetected.html">plotGenesDetected</a></span>(bcb)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="kw"><a href="../reference/plotGeneSaturation.html">plotGeneSaturation</a></span>(bcb, <span class="dt">label =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="kw"><a href="../reference/plotGeneSaturation.html">plotGeneSaturation</a></span>(bcb, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-25-2.png" width="700"></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw"><a href="../reference/plotCountsPerGene.html">plotCountsPerGene</a></span>(bcb)</a></code></pre></div>
<pre><code>## 38142 non-zero genes detected</code></pre>
<pre><code>## Applying trimmed mean of M-values (TMM) normalization</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw"><a href="../reference/plotCountDensity.html">plotCountDensity</a></span>(</a>
<a class="sourceLine" id="cb103-2" data-line-number="2">    <span class="dt">object =</span> bcb,</a>
<a class="sourceLine" id="cb103-3" data-line-number="3">    <span class="dt">interestingGroups =</span> <span class="st">"sampleName"</span>,</a>
<a class="sourceLine" id="cb103-4" data-line-number="4">    <span class="dt">style =</span> <span class="st">"line"</span></a>
<a class="sourceLine" id="cb103-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## 38142 non-zero genes detected
## Applying trimmed mean of M-values (TMM) normalization</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-26-2.png" width="700"></p>
</div>
<div id="dispersion" class="section level2">
<h2 class="hasAnchor">
<a href="#dispersion" class="anchor"></a>Dispersion</h2>
<p>The following plot shows the dispersion by mean of normalized counts. We expect the dispersion to decrease as the mean of normalized counts increases.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw"><a href="../reference/plotDispEsts.html">plotDispEsts</a></span>(bcb)</a></code></pre></div>
<pre><code>## Coercing bcbioRNASeq to DESeqDataSet with DESeq2 1.24.0</code></pre>
<pre><code>## converting counts to integer mode</code></pre>
<pre><code>## estimating size factors</code></pre>
<pre><code>## estimating dispersions</code></pre>
<pre><code>## gene-wise dispersion estimates</code></pre>
<pre><code>## mean-dispersion relationship</code></pre>
<pre><code>## final dispersion estimates</code></pre>
<pre><code>## fitting model and testing</code></pre>
<pre><code>## -- replacing outliers and refitting for 3103 genes
## -- DESeq argument 'minReplicatesForReplace' = 7 
## -- original counts are preserved in counts(dds)</code></pre>
<pre><code>## estimating dispersions</code></pre>
<pre><code>## fitting model and testing</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
</div>
<div id="variance-stabilization-1" class="section level2">
<h2 class="hasAnchor">
<a href="#variance-stabilization-1" class="anchor"></a>Variance stabilization</h2>
<p>These plots show the standard deviation of normalized counts using <code><a href="https://rdrr.io/r/base/Log.html">log2()</a></code>, <code>varianceStabilizingTransform()</code>, <code>rlog()</code>, and <code><a href="../reference/tmm.html">tmm()</a></code> by <code><a href="https://rdrr.io/r/base/rank.html">rank(mean)</a></code>. Note that all counts shown are log2 scale.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="kw"><a href="../reference/plotMeanSD.html">plotMeanSD</a></span>(bcb)</a></code></pre></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div id="sample-similarity" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-similarity" class="anchor"></a>Sample similarity</h2>
<p>We can visualize sample similarity with principal component analysis (PCA) and hierarchical clustering of sample correlations. These functions support multiple normalization methods with the <code>normalized</code> argument. We recommend using <code>normalized = "vst"</code> by default.</p>
<p>Let’s plot the PCA using our <code>vst</code> counts, the current recommended default.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="kw"><a href="../reference/plotPCA.html">plotPCA</a></span>(bcb, <span class="dt">normalized =</span> <span class="st">"vst"</span>, <span class="dt">label =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Using vst counts</code></pre>
<pre><code>## Plotting PCA using 500 genes.</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw"><a href="../reference/plotPCA.html">plotPCA</a></span>(bcb, <span class="dt">normalized =</span> <span class="st">"vst"</span>, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Using vst counts
## Plotting PCA using 500 genes.</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-29-2.png" width="700"></p>
<p>Let’s visualize the <code>rlog</code> counts for comparison. The performance is similar overall, with some slight differences, but the grouping more or less remains the same.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw"><a href="../reference/plotPCA.html">plotPCA</a></span>(</a>
<a class="sourceLine" id="cb123-2" data-line-number="2">    <span class="dt">object =</span> bcb,</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">    <span class="dt">normalized =</span> <span class="st">"rlog"</span>,</a>
<a class="sourceLine" id="cb123-4" data-line-number="4">    <span class="dt">label =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb123-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## Using rlog counts</code></pre>
<pre><code>## Plotting PCA using 500 genes.</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="kw"><a href="../reference/plotPCA.html">plotPCA</a></span>(</a>
<a class="sourceLine" id="cb126-2" data-line-number="2">    <span class="dt">object =</span> bcb,</a>
<a class="sourceLine" id="cb126-3" data-line-number="3">    <span class="dt">normalized =</span> <span class="st">"rlog"</span>,</a>
<a class="sourceLine" id="cb126-4" data-line-number="4">    <span class="dt">label =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb126-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## Using rlog counts
## Plotting PCA using 500 genes.</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-30-2.png" width="700"></p>
<p>Generally, the <code>varianceStabilizationTransformation()</code> and <code>rlog()</code> functions provide similar performance, as seen here.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="kw"><a href="../reference/plotCorrelationHeatmap.html">plotCorrelationHeatmap</a></span>(</a>
<a class="sourceLine" id="cb128-2" data-line-number="2">    bcb,</a>
<a class="sourceLine" id="cb128-3" data-line-number="3">    <span class="dt">method =</span> <span class="st">"pearson"</span>,</a>
<a class="sourceLine" id="cb128-4" data-line-number="4">    <span class="dt">normalized =</span> <span class="st">"vst"</span>,</a>
<a class="sourceLine" id="cb128-5" data-line-number="5">    <span class="dt">color =</span> viridis<span class="op">::</span>viridis</a>
<a class="sourceLine" id="cb128-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## Using vst counts</code></pre>
<pre><code>## Calculating correlation matrix using pearson method.</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="kw"><a href="../reference/plotCorrelationHeatmap.html">plotCorrelationHeatmap</a></span>(</a>
<a class="sourceLine" id="cb131-2" data-line-number="2">    bcb,</a>
<a class="sourceLine" id="cb131-3" data-line-number="3">    <span class="dt">method =</span> <span class="st">"spearman"</span>,</a>
<a class="sourceLine" id="cb131-4" data-line-number="4">    <span class="dt">normalized =</span> <span class="st">"vst"</span>,</a>
<a class="sourceLine" id="cb131-5" data-line-number="5">    <span class="dt">color =</span> viridis<span class="op">::</span>plasma</a>
<a class="sourceLine" id="cb131-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## Using vst counts</code></pre>
<pre><code>## Calculating correlation matrix using spearman method.</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-31-2.png" width="700"></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="kw"><a href="../reference/plotCorrelationHeatmap.html">plotCorrelationHeatmap</a></span>(</a>
<a class="sourceLine" id="cb134-2" data-line-number="2">    <span class="dt">object =</span> bcb,</a>
<a class="sourceLine" id="cb134-3" data-line-number="3">    <span class="dt">method =</span> <span class="st">"pearson"</span>,</a>
<a class="sourceLine" id="cb134-4" data-line-number="4">    <span class="dt">normalized =</span> <span class="st">"rlog"</span>,</a>
<a class="sourceLine" id="cb134-5" data-line-number="5">    <span class="dt">color =</span> viridis<span class="op">::</span>viridis</a>
<a class="sourceLine" id="cb134-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## Using rlog counts</code></pre>
<pre><code>## Calculating correlation matrix using pearson method.</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="kw"><a href="../reference/plotCorrelationHeatmap.html">plotCorrelationHeatmap</a></span>(</a>
<a class="sourceLine" id="cb137-2" data-line-number="2">    <span class="dt">object =</span> bcb,</a>
<a class="sourceLine" id="cb137-3" data-line-number="3">    <span class="dt">method =</span> <span class="st">"spearman"</span>,</a>
<a class="sourceLine" id="cb137-4" data-line-number="4">    <span class="dt">normalized =</span> <span class="st">"rlog"</span>,</a>
<a class="sourceLine" id="cb137-5" data-line-number="5">    <span class="dt">color =</span> viridis<span class="op">::</span>plasma</a>
<a class="sourceLine" id="cb137-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## Using rlog counts</code></pre>
<pre><code>## Calculating correlation matrix using spearman method.</code></pre>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-32-2.png" width="700"></p>
</div>
</div>
<div id="saving-counts" class="section level1">
<h1 class="hasAnchor">
<a href="#saving-counts" class="anchor"></a>Saving counts</h1>
<p>The <code><a href="../reference/counts.html">counts()</a></code> function returns the abundance estimates generated by Salmon. Read counts for each sample in the dataset are aggregated into a matrix, in which columns correspond to samples and rows represent genes. Multiple normalized counts matrices are saved in the bcbioRNASeq object, and are accessible with <code>normalized</code> argument:</p>
<ul>
<li>
<code>FALSE</code>: Raw counts (<em>default</em>).</li>
<li>
<code>TRUE</code>: <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a> normalized counts.</li>
<li>
<code>"tpm"</code>: Transcripts per million, calculated by <a href="https://doi.org/doi:10.18129/B9.bioc.tximport">tximport</a>.</li>
<li>
<code>"tmm"</code>: Trimmed mean of M-values normalization method.</li>
<li>
<code>"vst"</code>: Variance stabilization transformation.</li>
<li>
<code>"rlog"</code>: Regularized log transformation.</li>
<li>
<code>"rle"</code>: Relative log expression transformation.</li>
</ul>
<p>We recommend saving the raw counts, normalized counts, TPMs, and variance-stabilized counts to disk both in binary R Data and CSV formats.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">raw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/counts.html">counts</a></span>(bcb, <span class="dt">normalized =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb140-2" data-line-number="2">normalized &lt;-<span class="st"> </span><span class="kw"><a href="../reference/counts.html">counts</a></span>(bcb, <span class="dt">normalized =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb140-3" data-line-number="3">tpm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/counts.html">counts</a></span>(bcb, <span class="dt">normalized =</span> <span class="st">"tpm"</span>)</a>
<a class="sourceLine" id="cb140-4" data-line-number="4">vst &lt;-<span class="st"> </span><span class="kw"><a href="../reference/counts.html">counts</a></span>(bcb, <span class="dt">normalized =</span> <span class="st">"vst"</span>)</a>
<a class="sourceLine" id="cb140-5" data-line-number="5"><span class="kw">saveData</span>(raw, normalized, tpm, vst, <span class="dt">dir =</span> <span class="st">"."</span>)</a>
<a class="sourceLine" id="cb140-6" data-line-number="6"><span class="kw">writeCounts</span>(raw, normalized, tpm, vst, <span class="dt">dir =</span> <span class="st">"."</span>)</a></code></pre></div>
</div>
<div id="differential-expression" class="section level1">
<h1 class="hasAnchor">
<a href="#differential-expression" class="anchor"></a>Differential expression</h1>
<p><a href="http://bioinformatics.sph.harvard.edu/bcbioRNASeq">bcbioRNASeq</a> integrates with <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a>, which we recommend for differential expression. To prepare our dataset for analysis, we need to coerce the <code>bcbioRNASeq</code> object to a <code>DESeqDataSet</code>. Use the <code><a href="../reference/coerce.html">as()</a></code> function or refer to the <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a> documentation for the <code>DESeqDataSet()</code> constructor.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">dds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/coerce.html">as</a></span>(bcb, <span class="st">"DESeqDataSet"</span>)</a></code></pre></div>
<pre><code>## Coercing bcbioRNASeq to DESeqDataSet with DESeq2 1.24.0</code></pre>
<pre><code>## converting counts to integer mode</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(dds)</a></code></pre></div>
<pre><code>## class: DESeqDataSet 
## dim: 51652 12 
## metadata(31): version level ... subset brio
## assays(6): counts tpm ... rlog vst
## rownames(51652): ENSMUSG00000000001 ENSMUSG00000000003 ...
##   ENSMUSG00000114967 ENSMUSG00000114968
## rowData names(7): geneID geneName ... entrezID broadClass
## colnames(12): control_rep1 control_rep2 ... fa_day7_rep2
##   fa_day7_rep3
## colData names(26): sampleName day ... x5x3Bias xGC</code></pre>
<p>Since both <code>bcbioRNASeq</code> and <code>DESeqDataSet</code> classes extend <code>RangedSummarizedExperiment</code>, internally we coerce the original <code>bcbioRNASeq</code> object to a <code>RangedSummarizedExperiment</code> and then use the <code>DESeqDataSet()</code> constructor, which requires a <code>SummarizedExperiment</code> with integer counts.</p>
<p>Here is the source code responsible for handing off the data to <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a>.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1"><span class="kw">getMethod</span>(</a>
<a class="sourceLine" id="cb146-2" data-line-number="2">    <span class="dt">f =</span> <span class="st">"coerce"</span>,</a>
<a class="sourceLine" id="cb146-3" data-line-number="3">    <span class="kw">signature</span>(</a>
<a class="sourceLine" id="cb146-4" data-line-number="4">        <span class="dt">from =</span> <span class="st">"bcbioRNASeq"</span>,</a>
<a class="sourceLine" id="cb146-5" data-line-number="5">        <span class="dt">to =</span> <span class="st">"DESeqDataSet"</span></a>
<a class="sourceLine" id="cb146-6" data-line-number="6">    )</a>
<a class="sourceLine" id="cb146-7" data-line-number="7">)</a></code></pre></div>
<pre><code>## Method Definition:
## 
## function (from, to = "DESeqDataSet", strict = TRUE) 
## {
##     validObject(from)
##     if (metadata(from)[["level"]] != "genes") {
##         stop("Gene-level counts are required")
##     }
##     message(paste("Coercing bcbioRNASeq to DESeqDataSet with DESeq2", 
##         packageVersion("DESeq2")))
##     rse &lt;- as(from, "RangedSummarizedExperiment")
##     assay(rse) &lt;- round(assay(rse), digits = 0L)
##     to &lt;- DESeqDataSet(se = rse, design = ~1L)
##     interestingGroups(to) &lt;- interestingGroups(from)
##     validObject(to)
##     to
## }
## &lt;bytecode: 0x7fe4ba675100&gt;
## &lt;environment: namespace:bcbioRNASeq&gt;
## 
## Signatures:
##         from          to            
## target  "bcbioRNASeq" "DESeqDataSet"
## defined "bcbioRNASeq" "DESeqDataSet"</code></pre>
<p>Now you can perform differential expression analysis with <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a>. The authors of that package have provided a number of detailed, well documented references online:</p>
<ul>
<li>
<a href="http://bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html">Analyzing RNA-seq data with DESeq2</a>.</li>
<li>
<a href="http://dx.doi.org/10.12688/f1000research.7035.2">RNA-Seq workflow: gene-level exploratory analysis and differential expression</a>.</li>
<li>
<a href="https://f1000research.com/articles/4-1521/v2">Differential analyses for RNA-seq: transcript-level estimates improve gene-level inferences</a>.</li>
</ul>
<p>We also provide a parameterized <a href="https://rmarkdown.rstudio.com">R Markdown</a> template for standard <a href="https://doi.org/doi:10.18129/B9.bioc.DESeq2">DESeq2</a> differential expression, supporting analysis and visualization of multiple contrasts inside a single report. In our <a href="http://dx.doi.org/10.12688/f1000research.12093.2">workflow paper</a>, we also describe an example LRT analysis, and advanced edge-case templates are available inside our <a href="https://github.com/hbc/hbcABC">hbcABC</a> package, which is a current work in progress.</p>
</div>
<div id="functional-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#functional-analysis" class="anchor"></a>Functional analysis</h1>
<p>We provide an <a href="https://rmarkdown.rstudio.com">R Markdown</a> template for <a href="http://software.broadinstitute.org/gsea">gene set enrichment analysis (GSEA)</a> and <a href="https://www.genome.jp/kegg">Kyoto Encyclopedia of Genes and Genomes (KEGG)</a> pathway enrichment analysis <span class="citation">(Kanehisa and Goto 2000; Subramanian et al. 2005)</span>, which leverages the functionality of the <a href="https://doi.org/doi:10.18129/B9.bioc.clusterProfiler">clusterProfiler</a> package <span class="citation">(Yu et al. 2012)</span>. This workflow is described in detail in our <a href="http://dx.doi.org/10.12688/f1000research.12093.2">workflow paper</a>, and is outside the scope of this advanced use vignette. For more information on functional analysis, consult the <a href="https://doi.org/doi:10.18129/B9.bioc.clusterProfiler">clusterProfiler</a> vignette, which is extremely detailed and thorough.</p>
</div>
<div id="r-session-information" class="section level1">
<h1 class="hasAnchor">
<a href="#r-session-information" class="anchor"></a>R session information</h1>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</a></code></pre></div>
<pre><code>## R version 3.6.0 (2019-04-26)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Mojave 10.14.4
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R-3.6.0.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R-3.6.0.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats4    datasets  utils     grDevices graphics  stats    
## [8] methods   base     
## 
## other attached packages:
##  [1] hexbin_1.27.2               bcbioRNASeq_0.2.10         
##  [3] basejump_0.10.9             SummarizedExperiment_1.14.0
##  [5] DelayedArray_0.10.0         BiocParallel_1.18.0        
##  [7] matrixStats_0.54.0          Biobase_2.44.0             
##  [9] GenomicRanges_1.36.0        GenomeInfoDb_1.20.0        
## [11] IRanges_2.18.0              S4Vectors_0.22.0           
## [13] BiocGenerics_0.30.0         BiocStyle_2.12.0           
## 
## loaded via a namespace (and not attached):
##   [1] freerange_0.1.6               R.utils_2.8.0                
##   [3] tidyselect_0.2.5              RSQLite_2.1.1                
##   [5] AnnotationDbi_1.46.0          htmlwidgets_1.3              
##   [7] grid_3.6.0                    munsell_0.5.0                
##   [9] preprocessCore_1.46.0         codetools_0.2-16             
##  [11] withr_2.1.2                   colorspace_1.4-1             
##  [13] knitr_1.22                    rstudioapi_0.10              
##  [15] SingleCellExperiment_1.6.0    assertive.base_0.0-7         
##  [17] rdrop2_0.8.1                  labeling_0.3                 
##  [19] acidplots_0.2.4               lasso2_1.2-20                
##  [21] tximport_1.12.0               GenomeInfoDbData_1.2.1       
##  [23] mnormt_1.5-5                  bit64_0.9-7                  
##  [25] pheatmap_1.0.12               rprojroot_1.3-2              
##  [27] Matrix.utils_0.9.7            generics_0.0.2               
##  [29] xfun_0.6                      BiocFileCache_1.8.0          
##  [31] R6_2.4.0                      clue_0.3-57                  
##  [33] assertive.sets_0.0-3          locfit_1.5-9.1               
##  [35] AnnotationFilter_1.8.0        bitops_1.0-6                 
##  [37] reshape_0.8.8                 assertthat_0.2.1             
##  [39] promises_1.0.1                scales_1.0.0                 
##  [41] nnet_7.3-12                   gtable_0.3.0                 
##  [43] affy_1.62.0                   ensembldb_2.8.0              
##  [45] rlang_0.3.4                   genefilter_1.66.0            
##  [47] GlobalOptions_0.1.0           splines_3.6.0                
##  [49] rtracklayer_1.44.0            lazyeval_0.2.2               
##  [51] acepack_1.4.1                 broom_0.5.2                  
##  [53] checkmate_1.9.3               BiocManager_1.30.4           
##  [55] yaml_2.2.0                    reshape2_1.4.3               
##  [57] GenomicFeatures_1.36.0        backports_1.1.4              
##  [59] httpuv_1.5.1                  syntactic_0.1.9              
##  [61] Hmisc_4.2-0                   tools_3.6.0                  
##  [63] bookdown_0.10                 psych_1.8.12                 
##  [65] logging_0.9-107               ggplot2_3.1.1                
##  [67] affyio_1.54.0                 assertive.strings_0.0-3      
##  [69] RColorBrewer_1.1-2            goalie_0.2.16                
##  [71] ggdendro_0.1-20               sessioninfo_1.1.1            
##  [73] Rcpp_1.0.1                    plyr_1.8.4                   
##  [75] base64enc_0.1-3               progress_1.2.1               
##  [77] zlibbioc_1.30.0               purrr_0.3.2                  
##  [79] RCurl_1.95-4.12               prettyunits_1.0.2            
##  [81] rpart_4.1-15                  viridis_0.5.1                
##  [83] GetoptLong_0.1.7              cowplot_0.9.4                
##  [85] haven_2.1.0                   grr_0.9.5                    
##  [87] ggrepel_0.8.1                 cluster_2.0.9                
##  [89] fs_1.3.1                      magrittr_1.5                 
##  [91] data.table_1.12.2             openxlsx_4.1.0               
##  [93] circlize_0.4.6                ProtGenerics_1.16.0          
##  [95] hms_0.4.2                     mime_0.6                     
##  [97] evaluate_0.13                 bioverbs_0.1.19              
##  [99] xtable_1.8-4                  XML_3.98-1.19                
## [101] rio_0.5.16                    readxl_1.3.1                 
## [103] gridExtra_2.3                 shape_1.4.4                  
## [105] compiler_3.6.0                biomaRt_2.40.0               
## [107] tibble_2.1.1                  crayon_1.3.4                 
## [109] transformer_0.1.11            R.oo_1.22.0                  
## [111] htmltools_0.3.6               later_0.8.0                  
## [113] Formula_1.2-3                 tidyr_0.8.3                  
## [115] geneplotter_1.62.0            DBI_1.0.0                    
## [117] assertive.files_0.0-2         dbplyr_1.4.0                 
## [119] ComplexHeatmap_2.0.0          MASS_7.3-51.4                
## [121] rappdirs_0.3.1                assertive.numbers_0.0-2      
## [123] Matrix_1.2-17                 readr_1.3.1                  
## [125] brio_0.2.1                    cli_1.1.0                    
## [127] vsn_3.52.0                    assertive.types_0.0-3        
## [129] R.methodsS3_1.7.1             forcats_0.4.0                
## [131] pkgconfig_2.0.2               pkgdown_1.3.0.9000           
## [133] GenomicAlignments_1.20.0      foreign_0.8-71               
## [135] xml2_1.2.0                    roxygen2_6.1.1               
## [137] annotate_1.62.0               XVector_0.24.0               
## [139] stringr_1.4.0                 digest_0.6.18                
## [141] ConsensusClusterPlus_1.48.0   Biostrings_2.52.0            
## [143] cellranger_1.1.0              rmarkdown_1.12               
## [145] htmlTable_1.13.1              edgeR_3.26.1                 
## [147] curl_3.3                      shiny_1.3.2                  
## [149] Rsamtools_2.0.0               commonmark_1.7               
## [151] rjson_0.2.20                  jsonlite_1.6                 
## [153] nlme_3.1-140                  DEGreport_1.20.0             
## [155] viridisLite_0.3.0             desc_1.2.0                   
## [157] limma_3.40.0                  pillar_1.4.0                 
## [159] lattice_0.20-38               Nozzle.R1_1.1-1              
## [161] httr_1.4.0                    survival_2.44-1.1            
## [163] interactiveDisplayBase_1.22.0 glue_1.3.1                   
## [165] zip_2.0.2                     UpSetR_1.3.3                 
## [167] png_0.1-7                     bit_1.1-14                   
## [169] bcbioBase_0.6.4               assertive.properties_0.0-4   
## [171] stringi_1.4.3                 blob_1.1.1                   
## [173] DESeq2_1.24.0                 AnnotationHub_2.16.0         
## [175] latticeExtra_0.6-28           memoise_1.1.0                
## [177] dplyr_0.8.0.1</code></pre>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>The papers and software cited in our workflows are available as a <a href="https://paperpile.com/shared/e1q8fn">shared library</a> on <a href="https://paperpile.com">Paperpile</a>.</p>
<div id="refs" class="references">
<div id="ref-Bray2016-me">
<p>Bray, Nicolas L, Harold Pimentel, Páll Melsted, and Lior Pachter. 2016. “Near-Optimal Probabilistic RNA-seq Quantification.” <em>Nat. Biotechnol.</em> 34 (5): 525–27. <a href="https://doi.org/10.1038/nbt.3519">https://doi.org/10.1038/nbt.3519</a>.</p>
</div>
<div id="ref-Craciun2016-ha">
<p>Craciun, Florin L, Vanesa Bijol, Amrendra K Ajay, Poornima Rao, Ramya K Kumar, John Hutchinson, Oliver Hofmann, et al. 2016. “RNA Sequencing Identifies Novel Translational Biomarkers of Kidney Fibrosis.” <em>J. Am. Soc. Nephrol.</em> 27 (6): 1702–13. <a href="https://doi.org/10.1681/ASN.2015020225">https://doi.org/10.1681/ASN.2015020225</a>.</p>
</div>
<div id="ref-Dobin2013-hr">
<p>Dobin, Alexander, Carrie A Davis, Felix Schlesinger, Jorg Drenkow, Chris Zaleski, Sonali Jha, Philippe Batut, Mark Chaisson, and Thomas R Gingeras. 2013. “STAR: Ultrafast Universal RNA-seq Aligner.” <em>Bioinformatics</em> 29 (1): 15–21. <a href="https://doi.org/10.1093/bioinformatics/bts635">https://doi.org/10.1093/bioinformatics/bts635</a>.</p>
</div>
<div id="ref-Dobin2016-qj">
<p>Dobin, Alexander, and Thomas R Gingeras. 2016. “Optimizing RNA-Seq Mapping with STAR.” <em>Methods Mol. Biol.</em> 1415: 245–62. <a href="https://doi.org/10.1007/978-1-4939-3572-7%5C_13">https://doi.org/10.1007/978-1-4939-3572-7\_13</a>.</p>
</div>
<div id="ref-Huber2015-nw">
<p>Huber, Wolfgang, Vincent J Carey, Robert Gentleman, Simon Anders, Marc Carlson, Benilton S Carvalho, Hector Corrada Bravo, et al. 2015. “Orchestrating High-Throughput Genomic Analysis with Bioconductor.” <em>Nat. Methods</em> 12 (2): 115–21. <a href="https://doi.org/10.1038/nmeth.3252">https://doi.org/10.1038/nmeth.3252</a>.</p>
</div>
<div id="ref-Kanehisa2000-hk">
<p>Kanehisa, M, and S Goto. 2000. “KEGG: Kyoto Encyclopedia of Genes and Genomes.” <em>Nucleic Acids Res.</em> 28 (1): 27–30. <a href="https://www.ncbi.nlm.nih.gov/pubmed/10592173">https://www.ncbi.nlm.nih.gov/pubmed/10592173</a>.</p>
</div>
<div id="ref-Kim2015-rr">
<p>Kim, Daehwan, Ben Langmead, and Steven L Salzberg. 2015. “HISAT: A Fast Spliced Aligner with Low Memory Requirements.” <em>Nat. Methods</em> 12 (4): 357–60. <a href="https://doi.org/10.1038/nmeth.3317">https://doi.org/10.1038/nmeth.3317</a>.</p>
</div>
<div id="ref-Lawrence2013-vz">
<p>Lawrence, Michael, Wolfgang Huber, Hervé Pagès, Patrick Aboyoun, Marc Carlson, Robert Gentleman, Martin T Morgan, and Vincent J Carey. 2013. “Software for Computing and Annotating Genomic Ranges.” <em>PLoS Comput. Biol.</em> 9 (8): e1003118. <a href="https://doi.org/10.1371/journal.pcbi.1003118">https://doi.org/10.1371/journal.pcbi.1003118</a>.</p>
</div>
<div id="ref-Liao2014-js">
<p>Liao, Yang, Gordon K Smyth, and Wei Shi. 2014. “FeatureCounts: An Efficient General Purpose Program for Assigning Sequence Reads to Genomic Features.” <em>Bioinformatics</em> 30 (7): 923–30. <a href="https://doi.org/10.1093/bioinformatics/btt656">https://doi.org/10.1093/bioinformatics/btt656</a>.</p>
</div>
<div id="ref-Love2014-sq">
<p>Love, Michael I, Wolfgang Huber, and Simon Anders. 2014. “Moderated Estimation of Fold Change and Dispersion for RNA-seq Data with DESeq2.” <em>Genome Biol.</em> 15 (12): 550. <a href="https://doi.org/10.1186/s13059-014-0550-8">https://doi.org/10.1186/s13059-014-0550-8</a>.</p>
</div>
<div id="ref-Patro2017-pi">
<p>Patro, Rob, Geet Duggal, Michael I Love, Rafael A Irizarry, and Carl Kingsford. 2017. “Salmon Provides Fast and Bias-Aware Quantification of Transcript Expression.” <em>Nat. Methods</em> 14 (4): 417–19. <a href="https://doi.org/10.1038/nmeth.4197">https://doi.org/10.1038/nmeth.4197</a>.</p>
</div>
<div id="ref-Patro2014-qz">
<p>Patro, Rob, Stephen M Mount, and Carl Kingsford. 2014. “Sailfish Enables Alignment-Free Isoform Quantification from RNA-seq Reads Using Lightweight Algorithms.” <em>Nat. Biotechnol.</em> 32 (5): 462–64. <a href="https://doi.org/10.1038/nbt.2862">https://doi.org/10.1038/nbt.2862</a>.</p>
</div>
<div id="ref-Soneson2016-tu">
<p>Soneson, Charlotte, Michael I Love, and Mark D Robinson. 2016. “Differential Analyses for RNA-seq: Transcript-Level Estimates Improve Gene-Level Inferences.” <em>F1000Res.</em> 4 (December). <a href="https://doi.org/10.12688/f1000research.7563.1">https://doi.org/10.12688/f1000research.7563.1</a>.</p>
</div>
<div id="ref-Steinbaugh2018-rc">
<p>Steinbaugh, Michael J, Lorena Pantano, Rory D Kirchner, Victor Barrera, Brad A Chapman, Mary E Piper, Meeta Mistry, et al. 2018. “bcbioRNASeq: R Package for Bcbio RNA-seq Analysis.” <em>F1000Res.</em> 6 (June). <a href="https://doi.org/10.12688/f1000research.12093.2">https://doi.org/10.12688/f1000research.12093.2</a>.</p>
</div>
<div id="ref-Subramanian2005-zk">
<p>Subramanian, Aravind, Pablo Tamayo, Vamsi K Mootha, Sayan Mukherjee, Benjamin L Ebert, Michael A Gillette, Amanda Paulovich, et al. 2005. “Gene Set Enrichment Analysis: A Knowledge-Based Approach for Interpreting Genome-Wide Expression Profiles.” <em>Proc. Natl. Acad. Sci. U. S. A.</em> 102 (43): 15545–50. <a href="https://doi.org/10.1073/pnas.0506580102">https://doi.org/10.1073/pnas.0506580102</a>.</p>
</div>
<div id="ref-Yu2012-ae">
<p>Yu, Guangchuang, Li-Gen Wang, Yanyan Han, and Qing-Yu He. 2012. “ClusterProfiler: An R Package for Comparing Biological Themes Among Gene Clusters.” <em>OMICS</em> 16 (5): 284–87. <a href="https://doi.org/10.1089/omi.2011.0118">https://doi.org/10.1089/omi.2011.0118</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#loading-bcbio-data">Loading bcbio data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#upload-directory">Upload directory</a></li>
      <li><a href="#counts-level">Counts level</a></li>
      <li><a href="#expression-callers">Expression callers</a></li>
      <li><a href="#sample-selection-and-metadata">Sample selection and metadata</a></li>
      <li><a href="#genome-annotations">Genome annotations</a></li>
      <li><a href="#variance-stabilization">Variance stabilization</a></li>
      </ul>
</li>
      <li><a href="#use-case-dataset">Use case dataset</a></li>
      <li><a href="#sample-metadata">Sample metadata</a></li>
      <li><a href="#interesting-groups">Interesting groups</a></li>
      <li>
<a href="#quality-control">Quality control</a><ul class="nav nav-pills nav-stacked">
<li><a href="#read-counts">Read counts</a></li>
      <li><a href="#mapping-rates">Mapping rates</a></li>
      <li><a href="#rrna-mapping-rate">rRNA mapping rate</a></li>
      <li><a href="#bias">5’-&gt;3’ bias</a></li>
      <li><a href="#gene-distributions">Gene distributions</a></li>
      <li><a href="#dispersion">Dispersion</a></li>
      <li><a href="#variance-stabilization-1">Variance stabilization</a></li>
      <li><a href="#sample-similarity">Sample similarity</a></li>
      </ul>
</li>
      <li><a href="#saving-counts">Saving counts</a></li>
      <li><a href="#differential-expression">Differential expression</a></li>
      <li><a href="#functional-analysis">Functional analysis</a></li>
      <li><a href="#r-session-information">R session information</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://steinbaugh.com">Michael Steinbaugh</a>, <a href="https://lpantano.github.io">Lorena Pantano</a>, <a href="https://github.com/roryk">Rory Kirchner</a>, <a href="https://github.com/vbarrera">Victor Barrera</a>, <a href="https://github.com/chapmanb">Brad Chapman</a>, <a href="https://github.com/marypiper">Mary Piper</a>, <a href="https://github.com/mistrm82">Meeta Mistry</a>, <a href="https://github.com/rkhetani">Radhika Khetani</a>, <a href="https://github.com/KayleighRutherford">Kayleigh Rutherford</a>, <a href="https://github.com/ohofmann">Oliver Hofmann</a>, <a href="https://github.com/jnhutchinson">John Hutchinson</a>, <a href="https://github.com/sjhosui">Shannan Ho Sui</a>, <a href="http://bioinformatics.sph.harvard.edu">Harvard Chan Bioinformatics Core</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
